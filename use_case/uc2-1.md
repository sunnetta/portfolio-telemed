## UC-2.1 Записаться на консультацию

**ID:** UC-2.1

**Название:** Записаться на консультацию

**Действующее лицо:** Пациент

**Предусловие**: -

**Триггер**: -

**Постусловие**: Система создаёт анкету симптомов

**Основной поток:**

1. Пользователь заходит на форму онлайн-расписания.
2. Система даёт возможность пользователю найти врача.
3. Пользователь находит врача (UC-2.2).
4. Система отображает расписание врача.
5. Система даёт возможность пользователю выбрать слот врача.
6. Система отображает пациенту список дат с доступными для бронирования слотами.
7. Система предлагает пациенту выбрать дату для отображения списка слотов на этот день.
8. Пациент выбирает дату.
9. Система отображает список слотов врача с атрибутами [Слот]:дата = выбранная дата.
10. Система даёт возможность пользователю забронировать выбранный слот.
11. Пользователь даёт команду забронировать слот.
12. Система убеждается, что пользователь авторизован в системе.
13. Система редактирует Слот со следующими атрибутами:
[Слот]:статус = 'Занят'.
14. Система передаёт в смежную систему Битрикс24 (UC-4.3) статус слота.
15. Система создаёт консультацию.
16. Система убеждается, что с момента создания консультации прошло < Т минут.
17. Система даёт возможность пользователю оплатить консультацию.
18. Пользователь даёт команду оплатить консультацию (UC-2.3).
19. Система убеждается, что консультация оплачена.
20. Система редактирует Консультацию со следующими атрибутами: 
[Консультация]:статус = 'Запланирована'.
21. Система уведомляет пользователя об успешном создании консультации.
22. Система отправляет пользователю уведомление выбранным им способом (UC-1.7).
23. Система уведомляет пользователя о необходимости заполнить анкету симптомов (UC-2.7).
24. Сценарий окончен.

**Расширение**:

12а. Пользователь не авторизован в системе.

  12а1. Система предлагает пользователю авторизоваться. 

  12а2. Пользователь авторизуется в системе (UC - 1.2)

  12а3. Сценарий переходит к шагу 8.

15а. Система не создала консультацию.

  15а1. Система сообщает пользователю об ошибке при создании консультации.

  15а2. Сценарий окончен.

16а. Система убедилась, что с момента создания консультации прошло ≥ 20 минут.

  16а1. Система не даёт возможность оплатить консультацию.

  16а2. Система сообщает пациенту о том, что время оплаты истекло и забронированный слот освобождён.

  16а3. Система редактирует Слот со следующими атрибутами:

            [Слот]:статус = 'Свободен'.

  16а4. Система передаёт в смежную систему Битрикс24 (UC-4.3) статус слота.

  16а5. Система удаляет Консультацию с атрибутом [Консультация]:слот = [Слот]:id.

  16а6. Сценарий окончен.

18а. Пользователь не даёт команду оплатить консультацию.

  18а1. Система ожидает подтверждения оплаты.

  18а2. Сценарий переходит на шаг 16.

19а. Система не получила подтверждение успешной оплаты.

  19а1. Система сообщает пользователю о НЕуспешной оплате.

  19а2. Система даёт возможность оплатить консультацию заново.

  19а3. Сценарий переходит на шаг 16.