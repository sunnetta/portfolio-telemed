### Возврат оплаты при отмене консультаций

**User Story:** 
>Я, как пациент, хочу получить возврат оплаты при отмене консультации, чтобы вернуть свои деньги за неоказанную услугу.

**Общее предусловие:** Пациент записан на онлайн-консультацию. Приём был заранее оплачен банковской картой.

1. **СЦЕНАРИЙ**: Отмена консультации по вине клиники.
**ДАНО**: У клиники возникла необходимость отменить консультацию по независящим от пациента причинам.
**КОГДА** администратор инициирует отмену записи с возвратом оплаты,
**ТО** система изменяет статус записи на ОТМЕНЕНА,
**И** система изменяет статус слота в расписании врача на СВОБОДЕН,
**И** система уведомляет *администратора* об успешной отмене консультации,
**И** система уведомляет *врача* об освобождении слота,
**И** система уведомляет *пациента* об отмене консультации,
**И** система инициирует возврат стоимости отменённой консультации,
**ЕСЛИ** система получает подтверждение операции возврата от смежной платёжной системы,
**ТО** система уведомляет *пациента* об успешном возврате оплаты,
**И** система уведомляет *администратора* об успешном возврате оплаты пациенту,
**ЕСЛИ** система НЕ получает подтверждение операции возврата от смежной платёжной системы,
**ТО** система уведомляет *администратора* о **не**успешной операции возврата оплаты пациенту и необходимости повторить операцию.

2. **СЦЕНАРИЙ**: Отмена консультации по инициативе пациента за Х часов до приёма.
**КОГДА** пациент инициирует отмену своей записи в системе,
**ТО** система изменяет статус записи пациента на ОТМЕНЕНА,
**И** система изменяет статус слота в расписании врача на СВОБОДЕН,
**И** система уведомляет *врача* об освобождении слота,
**И** система проверяет оставшееся время до приема,
**ЕСЛИ** оставшееся время более 24 часов,
**ТО** система инициирует возврат стоимости отменённой консультации,
 **ЕСЛИ** система получает подтверждение операции возврата от смежной платёжной системы,
 **ТО** система уведомляет *пациента* об отмене консультации и успешном возврате оплаты,
 **ЕСЛИ** система НЕ получает подтверждение операции возврата от смежной платёжной системы,
 **ТО** система уведомляет *пациента* об отмене консультации и **не**успешной операции возврата оплаты,
 **И** система уведомляет *администратора* о **не**успешной операции возврата оплаты пациенту и необходимости повторить операцию,
**ЕСЛИ** оставшееся время меньше или равно 24 часа,
**ТО** система уведомляет *пациента* об отмене консультации.

3. **СЦЕНАРИЙ**: Отмена консультации за X часов до приёма из-за незаполненной анкеты симптомов.
**КОГДА**: До приёма осталось ровно X часов,
**И** анкета симптомов пациента не заполнена,
**ТО** система изменяет статус записи пациента на ОТМЕНЕНА,
**И** система изменяет статус слота в расписании врача на СВОБОДЕН,
**И** система уведомляет *пациента* об отмене консультации,
**И** система уведомляет *врача* об освобождении слота.

4. **СЦЕНАРИЙ**: Отмена консультации за X часов до приёма из-за незаполненной анкеты анамнеза.
**КОГДА**: До приёма осталось ровно X часов,
**И** анкета анамнеза пациента не заполнена,
**ТО** система изменяет статус записи пациента на ОТМЕНЕНА,
**И** система изменяет статус слота в расписании врача на СВОБОДЕН,
**И** система уведомляет *пациента* об отмене консультации,
**И** система уведомляет *врача* об освобождении слота.

### Просмотр расписания врачей

**User Story:**
>Я, как пациент, хочу просматривать расписание врачей без авторизации, чтобы быстро проверить есть ли подходящее мне время приёма, доступное для записи.

**СЦЕНАРИЙ**: Просмотр расписания врачей не авторизованным пациентом.
**КОГДА** пациент заходит на сайт,
**И** пациент не авторизован в системе,
**И** пациент запрашивает просмотр расписания,
**ТО** система предлагает задать критерии поиска расписания врача,
**ЕСЛИ** пациент знает ФИО врача,
**ТО** система предлагает ввести ФИО врача,
**КОГДА** пациент вводит ФИО врача,
**ТО** система отображает доступные дни этого врача в расписании,
**ЕСЛИ** пациент выбирает конкретный день из предложенных,
**ТО** система отображает доступные слоты в этот день
**И** система не даёт возможности забронировать любой из них без авторизации в системе.

### Возможность отменить бронирование слота до оплаты записи

**User Story**:  Я, как пациент, хочу отменить забронированный слот до оплаты записи, чтобы сохранить свои деньги в случае, если я передумаю записываться на приём

**ДАНО**: Пациент забронировал слот и ещё не оплатил его.

1. **СЦЕНАРИЙ**: Пациент отменяет бронь до оплаты записи.
**ДАНО:** с момента бронирования прошло менее X минут.
**КОГДА** пациент хочет отменить бронь,
**ТО** система предоставляет возможность отменить бронирование слота,
**ЕСЛИ** пациент подтвердил отмену,
**ТО** система переводит слот врача в статус СВОБОДЕН,
**И** система уведомляет пациента об успешной отмене бронирования.

2. **СЦЕНАРИЙ**: Автоматическая отмена неоплаченного слота через X минут.
**КОГДА** с момента бронирования прошло ровно X минут,
**И** система **не** получила подтверждение об успешной операции оплаты,
**ТО** система переводит слот врача в статус СВОБОДЕН,
**И** система уведомляет пациента об отмене бронирования.